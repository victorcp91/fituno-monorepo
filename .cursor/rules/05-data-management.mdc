---
description: 
globs: 
alwaysApply: false
---
# Data Management and State Handling

## Supabase Integration

1. **Database Structure**
   - Follow proper schema design
   - Implement RLS policies
   - Use appropriate indexes
   - Maintain referential integrity

2. **Query Optimization**
   - Use efficient queries
   - Implement proper filtering
   - Use pagination where appropriate
   - Monitor query performance

## React Query Usage

1. **Cache Configuration**
   - Configure proper staleTime:
     - Exercises: 24h
     - Workouts: 5min
     - Chat: 10s when active
   - Implement proper cache invalidation
   - Use optimistic updates
   - Handle cache errors

2. **Query Organization**
   - Use proper queryKey structure
   - Implement proper prefetching
   - Handle background updates
   - Manage parallel queries

## State Management

1. **Global State**
   - Use Zustand for global state
   - Keep state minimal
   - Document state structure
   - Handle state persistence

2. **Local State**
   - Use React state for UI
   - Implement proper state updates
   - Handle state transitions
   - Clean up on unmount

## Data Validation

1. **Schema Validation**
   - Use Zod for all data validation
   - Validate at boundaries
   - Handle validation errors
   - Document validation rules

2. **Form Handling**
   - Use React Hook Form
   - Implement proper validation
   - Show validation errors
   - Handle form submission

## Error Handling

1. **API Errors**
   - Handle network errors
   - Show appropriate messages
   - Implement retry logic
   - Log errors properly

2. **Data Errors**
   - Validate data integrity
   - Handle missing data
   - Show data error states
   - Implement recovery

## Performance

1. **Data Loading**
   - Implement proper loading states
   - Use pagination/infinite scroll
   - Handle large datasets
   - Optimize initial load

2. **Updates and Mutations**
   - Use optimistic updates
   - Handle concurrent updates
   - Implement proper rollback
   - Show update progress

## Data Types

1. **Type Definitions**
   - Use proper TypeScript types
   - Share types across apps
   - Document type usage
   - Maintain type safety

2. **Data Transformations**
   - Transform at boundaries
   - Use proper serialization
   - Handle data migration
   - Validate transformed data
