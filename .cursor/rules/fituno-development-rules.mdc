---
description: 
globs: 
alwaysApply: false
---
# Fituno - Regras de Desenvolvimento

## ğŸ“‹ Stack TecnolÃ³gico

### Web App (trainer-app)
- **Framework:** Next.js 15 com App Router e React Server Components
- **Linguagem:** TypeScript
- **UI:** shadcn/ui + Tailwind CSS
- **Testes:** Vitest + React Testing Library
- **Estrutura:** [apps/trainer-app/](mdc:apps/trainer-app) conforme [monorepo.md](mdc:docs/monorepo.md)

### Mobile App (client-app)
- **Framework:** Expo SDK (latest) + React Native
- **UI:** React Native Paper
- **Testes:** Jest + React Testing Library
- **Estrutura:** [apps/client-app/](mdc:apps/client-app) conforme [monorepo.md](mdc:docs/monorepo.md)

### Pacotes Compartilhados
- **Gerenciamento:** Yarn Workspaces conforme [package.json](mdc:package.json)
- **Tipos:** `@fituno/types` em [packages/types/](mdc:packages/types)
- **UtilitÃ¡rios:** `@fituno/utils` em [packages/utils/](mdc:packages/utils)
- **ServiÃ§os:** `@fituno/services` (Supabase & Stripe) em [packages/services/](mdc:packages/services)
- **Constantes:** `@fituno/constants` em [packages/constants/](mdc:packages/constants)

## ğŸ”„ Fluxo de Trabalho

### 1. SeleÃ§Ã£o de Tarefas
```bash
# Usar comando de tarefas para selecionar prÃ³xima do backlog
/tasks
```

### 2. Desenvolvimento
- Gere cÃ³digo **E** testes unitÃ¡rios completos
- Execute `pnpm test` atÃ© todos os testes passarem
- Siga as diretrizes de cÃ³digo abaixo

### 3. Commit & Push
```bash
# ApÃ³s implementar cada tarefa
git add -A
# Gerar commit usando Conventional Commits (ver template abaixo)
# Incluir ID da task no scope se existir
git push
```

### 4. FrequÃªncia
- Push apÃ³s cada task OU a cada 2-3 commits

## ğŸ“‹ Gerenciamento de Tasks - FITUNO_TASKS.md

### Prioridade das Tasks por Aplicativo
**OBRIGATÃ“RIO:** Seguir ordem de prioridade definida em [FITUNO_TASKS.md](mdc:FITUNO_TASKS.md)

#### Trainer App (Web) - Ordem de Prioridade:
1. **Task 5:** Trainer Web App Foundation (5.1 â†’ 5.5)
2. **Task 7:** Plan & Subscription System (7.1 â†’ 7.4)
3. **Task 8:** Client Management System (8.1 â†’ 8.4)
4. **Task 9:** Anamnesis System - Trainer Side (9.1 â†’ 9.4)
5. **Task 11:** Workout Builder (11.1 â†’ 11.6)
6. **Task 14:** Chat System - Trainer Side (14.1 â†’ 14.4)
7. **Task 13:** Progress Tracking & Media - Trainer Side (13.1 â†’ 13.3)

#### Client App (Mobile) - Ordem de Prioridade:
1. **Task 6:** Client Mobile App Foundation (6.1 â†’ 6.5)
2. **Task 9:** Anamnesis System - Client Side (9.1 â†’ 9.3)
3. **Task 12:** Workout Execution (12.1 â†’ 12.4)
4. **Task 15:** Offline Support & Synchronization (15.1 â†’ 15.3)
5. **Task 17:** Media & Animation System (17.1 â†’ 17.3)
6. **Task 14:** Chat System - Client Side (14.1 â†’ 14.4)
7. **Task 13:** Progress Tracking & Media - Client Side (13.1 â†’ 13.3)
8. **Task 16:** Internationalization & Units (16.1 â†’ 16.2)
9. **Task 18:** Legal & Compliance (18.1 â†’ 18.2)

### CritÃ©rios de FinalizaÃ§Ã£o por Task
**OBRIGATÃ“RIO para cada subtask:**

#### 1. ImplementaÃ§Ã£o Completa
- [ ] Todos os pontos da subtask implementados
- [ ] CÃ³digo segue diretrizes de arquitetura
- [ ] Imports corretos usando aliases `@fituno/*`
- [ ] ValidaÃ§Ã£o Zod onde necessÃ¡rio

#### 2. Testes ObrigatÃ³rios
- [ ] **Cobertura mÃ­nima:** 80% branch coverage
- [ ] Testes unitÃ¡rios para todos os componentes/funÃ§Ãµes
- [ ] Testes de integraÃ§Ã£o para fluxos crÃ­ticos
- [ ] Edge cases cobertos conforme [FITUNO_TASKS.md](mdc:FITUNO_TASKS.md)
- [ ] Mocks apropriados para serviÃ§os externos

#### 3. ValidaÃ§Ã£o de Qualidade
- [ ] `yarn lint` sem erros
- [ ] `yarn test` todos os testes passando
- [ ] Build da aplicaÃ§Ã£o funcionando (`yarn build`)
- [ ] VerificaÃ§Ã£o manual dos critÃ©rios de aceite

#### 4. Commit ObrigatÃ³rio
```bash
# Formato especÃ­fico para tasks
git add -A
git commit -m "feat(task-[ID]): [descriÃ§Ã£o da subtask]

- Implementa [funcionalidade especÃ­fica]
- Adiciona testes com [%] de cobertura
- [Outros detalhes relevantes]

Closes: Task [ID].[subtask]"
git push
```

### Bloqueadores de Progresso
**NÃƒO prosseguir para prÃ³xima task/subtask se:**
- [ ] Testes nÃ£o atingem 80% de cobertura
- [ ] Lint com erros nÃ£o resolvidos
- [ ] Build falhando
- [ ] CritÃ©rios de aceite nÃ£o atendidos
- [ ] Commit nÃ£o realizado

### Templates de VerificaÃ§Ã£o

#### Checklist de Subtask ConcluÃ­da
```
âœ… Subtask [ID].[N] - [Nome]
- [ ] ImplementaÃ§Ã£o completa âœ“
- [ ] Testes â‰¥ 80% cobertura âœ“  
- [ ] Lint sem erros âœ“
- [ ] Build funcionando âœ“
- [ ] Commit realizado âœ“
- [ ] Push executado âœ“
```

#### Comando de VerificaÃ§Ã£o RÃ¡pida
```bash
# Executar antes de commit
yarn lint && yarn test && yarn build
```

### AtualizaÃ§Ã£o do FITUNO_TASKS.md
**OBRIGATÃ“RIO:** Manter o arquivo [FITUNO_TASKS.md](mdc:FITUNO_TASKS.md) atualizado como fonte da verdade do progresso.

#### 1. AtualizaÃ§Ã£o de Status
**ApÃ³s concluir cada subtask:**
```markdown
# No arquivo FITUNO_TASKS.md, atualizar a coluna Status:
| ID  | Title                    | Status    | 
| --- | ------------------------ | --------- |
| 5.1 | Next.js Project Setup    | âœ… Done   |
| 5.2 | ShadCN UI Integration    | ğŸš§ In Progress |
| 5.3 | App Router Configuration | â³ Pending |
```

#### 2. IdentificaÃ§Ã£o da PrÃ³xima Task
**Antes de iniciar nova task:**
- [ ] Verificar dependÃªncias atendidas
- [ ] Confirmar ordem de prioridade por aplicativo
- [ ] Atualizar status para "ğŸš§ In Progress"
- [ ] Documentar inÃ­cio no arquivo

#### 3. Template de AtualizaÃ§Ã£o
```markdown
## Task [ID] - [Nome da Task]
**Status:** âœ… ConcluÃ­da | **Data:** [DD/MM/YYYY]

### Subtasks Implementadas:
- âœ… [ID.1] [Nome] - Implementado com [%] cobertura de testes
- âœ… [ID.2] [Nome] - Implementado com [%] cobertura de testes
- âœ… [ID.3] [Nome] - Implementado com [%] cobertura de testes

### PrÃ³xima Task: [ID+1] - [Nome]
**DependÃªncias:** Todas atendidas âœ…
**Prioridade:** [Alta/MÃ©dia/Baixa]
**App:** [Trainer/Client]
```

#### 4. Versionamento do Progresso
**A cada task major concluÃ­da, adicionar seÃ§Ã£o:**
```markdown
---
## ğŸ“Š Status do Projeto - [Data]

### Trainer App (Web):
- âœ… Task 5: Foundation (5/5 subtasks)
- ğŸš§ Task 7: Subscription System (2/4 subtasks)
- â³ Task 8: Client Management (0/4 subtasks)

### Client App (Mobile):
- âœ… Task 6: Foundation (5/5 subtasks)
- â³ Task 9: Anamnesis (0/3 subtasks)

### PrÃ³ximas Prioridades:
1. Task 7.3 - Checkout Flow (Trainer)
2. Task 9.1 - Form Renderer (Client)
---
```

#### 5. Comandos para AtualizaÃ§Ã£o
```bash
# ApÃ³s concluir subtask
git add FITUNO_TASKS.md
git commit -m "docs(task-[ID]): atualiza status para concluÃ­da

- Marca subtask [ID].[N] como concluÃ­da
- Atualiza prÃ³xima task na sequÃªncia
- Documenta progresso e cobertura de testes"
```

### Fluxo Completo de Task
**SequÃªncia obrigatÃ³ria para cada subtask:**

1. **InÃ­cio:**
   - [ ] Atualizar FITUNO_TASKS.md: status â†’ "ğŸš§ In Progress"
   - [ ] Commit da atualizaÃ§Ã£o de status

2. **Desenvolvimento:**
   - [ ] Implementar funcionalidade
   - [ ] Escrever testes (â‰¥80% cobertura)
   - [ ] Resolver lint e build

3. **FinalizaÃ§Ã£o:**
   - [ ] Commit da implementaÃ§Ã£o
   - [ ] Atualizar FITUNO_TASKS.md: status â†’ "âœ… Done"
   - [ ] Identificar prÃ³xima task na sequÃªncia
   - [ ] Commit da atualizaÃ§Ã£o final

4. **ValidaÃ§Ã£o:**
   - [ ] Verificar se todas as subtasks da task major estÃ£o concluÃ­das
   - [ ] Se sim: atualizar status da task major
   - [ ] Identificar prÃ³xima task major conforme prioridade

## ğŸ“ Diretrizes de CÃ³digo

### Estrutura & Imports
- **SEMPRE** respeite aliases `@fituno/...` conforme [monorepo.md](mdc:docs/monorepo.md)
- **SEMPRE** siga estrutura de pastas documentada em [monorepo.md](mdc:docs/monorepo.md)
- Imports de pacotes compartilhados:
  ```typescript
  import { WorkoutPlan } from "@fituno/types";
  import { formatCurrency } from "@fituno/utils";
  import { supabase } from "@fituno/services";
  ```

### ValidaÃ§Ã£o & API
- **OBRIGATÃ“RIO:** ValidaÃ§Ã£o de entrada com Zod
- **API Routes:** Sempre em `app/api/**/route.ts` (Next.js App Router)
- **Tipos:** Usar tipagens de `@fituno/types` como fonte da verdade

### Supabase & ServiÃ§os Externos
- **Acesso Supabase:** DisponÃ­vel via servidor MCP integrado ao agente
- **Ferramentas MCP:** Use as funÃ§Ãµes do Supabase diretamente quando necessÃ¡rio
- **Database Operations:** Pode executar SQL, criar migraÃ§Ãµes, gerenciar tabelas
- **Tipos TypeScript:** Pode gerar tipos automaticamente do schema
- **Branches:** Pode criar/gerenciar development branches
- **Edge Functions:** Pode deployar funÃ§Ãµes serverless
- **Storage:** Pode gerenciar arquivos e media

#### Uso das Ferramentas MCP Supabase
```typescript
// Exemplo de acesso direto via MCP durante desenvolvimento:
// - Criar/aplicar migraÃ§Ãµes
// - Executar consultas SQL
// - Gerar tipos TypeScript
// - Gerenciar branches de desenvolvimento
// - Deploy de Edge Functions
// - Upload de arquivos para Storage
```

**IMPORTANTE:** Sempre use as ferramentas MCP do Supabase quando:
- Criar/modificar schema do database
- Aplicar migraÃ§Ãµes durante implementaÃ§Ã£o de tasks
- Gerar tipos TypeScript atualizados
- Testar consultas SQL
- Configurar RLS policies
- Gerenciar dados de desenvolvimento

### Componentes UI
#### Web (trainer-app)
- **UI Library:** shadcn/ui + Tailwind CSS
- **LocalizaÃ§Ã£o:** [apps/trainer-app/components/](mdc:apps/trainer-app/components)
- **SEMPRE** incluir story de teste

#### Mobile (client-app)  
- **UI Library:** React Native Paper
- **LocalizaÃ§Ã£o:** [apps/client-app/components/](mdc:apps/client-app/components)
- **SEMPRE** incluir story de teste

### Testes
- **Cobertura mÃ­nima:** 80% branch coverage
- **Ferramentas:** Vitest/RTL (web) ou Jest/RTL (mobile)
- **OBRIGATÃ“RIO:** Testar edge cases
- **LocalizaÃ§Ã£o:** Pasta `tests/` por domÃ­nio

## ğŸš€ Templates de Prompts RÃ¡pidos

### Componente Next.js 15
```
Gere um componente Next.js 15 responsivo usando Tailwind + shadcn/ui que [FUNCIONALIDADE]. 
Inclua testes Vitest/RTL e siga estrutura de [apps/trainer-app/](mdc:apps/trainer-app).
```

### API Route Segura
```
Escreva um route.ts para /api/[ENDPOINT] com:
- ValidaÃ§Ã£o Zod
- AutenticaÃ§Ã£o JWT 
- Rate limiting (5 req/min)
- Tipos de @fituno/types
- Estrutura Next.js 15 App Router
```

### Tela Expo
```
Crie uma screen Expo/React Native chamada [NOME] com:
- React Native Paper components
- NavegaÃ§Ã£o stack
- FormulÃ¡rio controlado com validaÃ§Ã£o Zod
- Teste Jest inicial
- Estrutura de [apps/client-app/](mdc:apps/client-app)
```

### Debug HidrataÃ§Ã£o
```
Estou recebendo 'hydration mismatch' nesta pÃ¡gina Next.js. 
Explique causas comuns e corrija passo a passo usando Next.js 15 + RSC.
```

### Testes UnitÃ¡rios
```
Escreva testes [Vitest/Jest]/RTL para este componente:
- Cubra edge-cases
- Alcance 80% branch coverage
- Use mocks apropriados para @fituno/services
- Siga padrÃµes do projeto
```

### Mensagem de Commit
```
Com base no diff a seguir, gere um commit convencional:
- Formato: tipo(scope): descriÃ§Ã£o
- Incluir ID da task no scope se existir
- Body detalhado se necessÃ¡rio
- Seguir Conventional Commits
```

## âœ… Definition of Done

### CritÃ©rios ObrigatÃ³rios
- [ ] CritÃ©rios de aceite da task atendidos
- [ ] Lint sem erros (`yarn lint`)
- [ ] Testes passando (`pnpm test`)
- [ ] Cobertura de testes â‰¥ 80%
- [ ] ValidaÃ§Ã£o Zod implementada (quando aplicÃ¡vel)
- [ ] Componentes UI seguem padrÃµes (shadcn/ui ou RN Paper)
- [ ] Commit criado com Conventional Commits
- [ ] Push executado

### Estrutura de Arquivos
- Respeitar organizaÃ§Ã£o por domÃ­nio em `features/`
- Componentes UI especÃ­ficos por app
- Hooks compartilhÃ¡veis em `packages/utils/hooks`
- Tipos globais em `packages/types`

## ğŸ”§ Comandos Ãšteis

```bash
# Desenvolvimento
yarn dev:trainer    # Iniciar trainer-app (web)
yarn dev:client     # Iniciar client-app (mobile)

# Build
yarn build:trainer  # Build trainer-app
yarn build:client   # Build client-app  

# Qualidade
yarn lint          # Lint todos os workspaces
yarn test          # Executar testes em todos os workspaces
```

### Supabase via MCP
O agente tem acesso direto ao Supabase atravÃ©s do servidor MCP configurado:

**OperaÃ§Ãµes DisponÃ­veis:**
- ğŸ—„ï¸ **Database:** Criar tabelas, aplicar migraÃ§Ãµes, executar SQL
- ğŸ” **Auth:** Gerenciar usuÃ¡rios e polÃ­ticas de autenticaÃ§Ã£o  
- ğŸ“ **Storage:** Upload/download de arquivos e media
- âš¡ **Edge Functions:** Deploy de funÃ§Ãµes serverless
- ğŸŒ¿ **Branches:** Criar branches de desenvolvimento
- ğŸ“Š **Types:** Gerar tipos TypeScript do schema
- ğŸ” **Logs:** Acessar logs dos serviÃ§os
- ğŸ“– **Docs:** Buscar documentaÃ§Ã£o do Supabase

**Quando Usar MCP:**
- Durante implementaÃ§Ã£o de tasks que envolvem database
- Para aplicar migraÃ§Ãµes necessÃ¡rias para as funcionalidades
- Gerar tipos TypeScript atualizados apÃ³s mudanÃ§as no schema
- Testar consultas e validar RLS policies
- Deploy de Edge Functions para APIs customizadas

## ğŸ“ ReferÃªncias Importantes

- **Tasks completas:** [FITUNO_TASKS.md](mdc:FITUNO_TASKS.md)
- **Estrutura completa:** [docs/monorepo.md](mdc:docs/monorepo.md)
- **ConfiguraÃ§Ã£o workspaces:** [package.json](mdc:package.json)
- **Trainer app:** [apps/trainer-app/](mdc:apps/trainer-app)
- **Client app:** [apps/client-app/](mdc:apps/client-app)
- **Tipos compartilhados:** [packages/types/](mdc:packages/types)
- **UtilitÃ¡rios:** [packages/utils/](mdc:packages/utils)
- **ServiÃ§os:** [packages/services/](mdc:packages/services)
- **Constantes:** [packages/constants/](mdc:packages/constants)